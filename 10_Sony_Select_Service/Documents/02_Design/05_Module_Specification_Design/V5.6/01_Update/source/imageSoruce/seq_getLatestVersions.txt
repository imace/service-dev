@startuml

== 获取最新版本的应用信息列表  ==

Client --> PlayNowService_ServerApi : app.getLatestVersions
activate PlayNowService_ServerApi

PlayNowService_ServerApi --> BLL : PN_AppInfo.GetUpdateAppList
activate BLL

group Cache disable
    BLL --> DAL : IDAL.IPN_AppInfo.GetLatestVersionAppsList
    activate DAL
    DAL --> PlayNow.dbo : PN_AppInfo
    activate PlayNow.dbo
    DAL <-- PlayNow.dbo
    deactivate PlayNow.dbo
    BLL <-- DAL
    deactivate DAL

else Cache enable

    BLL --> BLL : Read From Cache

    group 如果cache中没有数据
        BLL --> DAL : IDAL.IPN_AppInfo.GetLatestVersionAppsList
        activate DAL
        DAL --> PlayNow.dbo : PN_AppInfo
        activate PlayNow.dbo
        DAL <-- PlayNow.dbo
        deactivate PlayNow.dbo
        BLL <-- DAL
        deactivate DAL
        BLL --> BLL : Add data into Cache
    end
end

BLL --> BLL : 使用linq在内存中匹配机型、包名

BLL --> BLL : 使用linq在内存中匹配最大版本

PlayNowService_ServerApi <-- BLL
deactivate BLL

Client <-- PlayNowService_ServerApi
deactivate PlayNowService_ServerApi

@enduml