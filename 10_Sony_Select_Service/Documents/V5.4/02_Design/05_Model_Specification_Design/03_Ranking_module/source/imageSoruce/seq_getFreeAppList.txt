@startuml

Client --> PlayNowService_ServerApi : app.getFreeAppList
activate PlayNowService_ServerApi

PlayNowService_ServerApi --> BLL : PN_WindowDownload.getFreeList
activate BLL

== 读取排行榜容量设置  ==

group Cache disable

    BLL --> DAL : IDAL.IPN_Configuration.GetConfiguration
    activate DAL
    DAL --> PlayNow.dbo : PN_Configuration / PN_ConfigurationType
    activate PlayNow.dbo
    DAL <-- PlayNow.dbo
    deactivate PlayNow.dbo
    BLL <-- DAL
    deactivate DAL

else Cache enable

    BLL --> BLL : Read From Cache

    group 如果cache中没有数据
        BLL --> DAL : IDAL.IPN_Configuration.GetConfiguration
        activate DAL
        DAL --> PlayNow.dbo : PN_Configuration / PN_ConfigurationType
        activate PlayNow.dbo
        DAL <-- PlayNow.dbo
        deactivate PlayNow.dbo
        BLL <-- DAL
        deactivate DAL
        BLL --> BLL : Add data into Cache
    end
end

== 获取排行榜应用列表  ==

group Cache disable
    BLL --> DAL : IDAL.IPN_WindowDownload.GetRankingList
    activate DAL
    DAL --> PlayNow.dbo : PN_WindowDownload / PN_AppInfo / PN_Machine
    activate PlayNow.dbo
    DAL <-- PlayNow.dbo
    deactivate PlayNow.dbo
    BLL <-- DAL
    deactivate DAL

else Cache enable

    BLL --> BLL : Read From Cache

    group 如果cache中没有数据
        BLL --> DAL : IDAL.IPN_WindowDownload.GetRankingList
        activate DAL
        DAL --> PlayNow.dbo : PN_WindowDownload / PN_AppInfo / PN_Machine
        activate PlayNow.dbo
        DAL <-- PlayNow.dbo
        deactivate PlayNow.dbo
        BLL <-- DAL
        deactivate DAL
        BLL --> BLL : Add data into Cache
    end
end

PlayNowService_ServerApi <-- BLL
deactivate BLL

Client <-- PlayNowService_ServerApi
deactivate PlayNowService_ServerApi

@enduml